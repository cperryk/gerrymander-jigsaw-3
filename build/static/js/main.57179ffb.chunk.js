(this["webpackJsonpgerrymander-jigsaw-3"]=this["webpackJsonpgerrymander-jigsaw-3"]||[]).push([[0],{141:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(48),r=a.n(s),o=(a(78),a(4)),c=a(5),l=a(7),h=a(6),u=a(8),d=a(9),p=a(2),v=a(63),m=a.n(v),g=a(10),f=(a(79),a(64)),b=function(){var e=Object(f.parse)(window.location.search,{parseBooleans:!0});if(!e.puzzle||"string"!==typeof e.puzzle)throw new Error("Puzzle not defined in the URL query string");return{puzzle:e.puzzle,parentUrl:"string"===e.parentUrl&&e.parentUrl||void 0,devMode:"boolean"===typeof e.devMode&&e.devMode||void 0}}();function w(e){var t=Math.floor(e/6e4);return[t,Math.round((e-60*t*1e3)/1e3)]}function E(e,t){var a=e.width,n=e.height,i=a/n;return i>t?{height:n,width:n*t}:i<t?{height:a/t,width:a}:{width:a,height:n}}var S=a(143),j=a(144),y=a(145),z=function(e){var t=e.title,a=e.subtitle,n=e.shareText,s=e.onRestart,r="string"===typeof b.parentUrl?decodeURIComponent(b.parentUrl):window.location.href;return i.a.createElement("div",{className:"slide fade-in"},i.a.createElement("div",null,i.a.createElement("h2",null,t),i.a.createElement("p",{className:"subtitle"},a),i.a.createElement("div",{className:"share-btns"},i.a.createElement(S.a,{className:"puzzle-btn",url:r,quote:n},i.a.createElement(g.a,{color:"rgb(59, 89, 152)"}),i.a.createElement("span",null,"Share")),i.a.createElement(j.a,{className:"puzzle-btn",url:r,title:n},i.a.createElement(g.e,{color:"rgb(64, 153, 255)"}),"Tweet"),i.a.createElement(y.a,{openWindow:!0,className:"puzzle-btn",url:r,subject:n},i.a.createElement(g.c,{color:"rgb(106, 4, 50)"}),"Email")),i.a.createElement("div",{className:"puzzle-btn",onClick:s},i.a.createElement(g.b,null),i.a.createElement("span",null,"Restart"))))},O=a(35),k=a(70),x=a.n(k),B=a(71),R=a.n(B),D=a(34),T=a.n(D),M=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).hoverColor=void 0,a.dragColor=void 0,a.state={color:a.props.color,dragging:!1,hovering:!1},a.hoverColor="rgb(100%, 100%, 44.1%)",a.dragColor="yellow",a.handleMouseEnter=a.handleMouseEnter.bind(Object(p.a)(a)),a.handleMouseOut=a.handleMouseOut.bind(Object(p.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.paths.map((function(t,a){return i.a.createElement("path",{d:t,className:"puzzle-piece-path",fill:e.state.color,key:a,cursor:e.props.locked?"normal":"move"})}));"object"===typeof this.props.svgRef&&this.props.svgRef.current;return i.a.createElement(R.a,{scale:this.props.dragScale,onStart:this.handleDragStart.bind(this),onStop:this.handleDragStop.bind(this),disabled:this.props.locked,position:{x:this.props.position[0],y:this.props.position[1]}},i.a.createElement("g",{className:T()({"puzzle-piece-group":!0,dragging:this.state.dragging,hovering:this.state.hovering}),onMouseEnter:this.handleMouseEnter,onMouseOut:this.handleMouseOut},i.a.createElement("rect",null),t))}},{key:"handleMouseEnter",value:function(){this.state.dragging||this.setState({hovering:!0})}},{key:"handleMouseOut",value:function(){this.state.dragging||this.setState({hovering:!1})}},{key:"handleDragStart",value:function(){this.setState({dragging:!0}),this.props.onDragStart(this.props.index)}},{key:"handleDragStop",value:function(e,t){this.setState({dragging:!1}),this.props.onDragStop(this.props.index,t)}}]),t}(i.a.PureComponent),N=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).ref=void 0,a.ref=i.a.createRef(),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.paths.map((function(e,t){return i.a.createElement("path",{className:"puzzle-guide-path",d:e,key:t})}));return i.a.createElement("g",{ref:this.ref},e)}},{key:"getBbox",value:function(){var e=this.ref;if("object"===typeof e&&e&&e.current)return e.current.getBoundingClientRect()}}]),t}(i.a.Component),P=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).ref=void 0;var n=x.a.scale("Spectral").domain([0,e.pieces.length],e.pieces.length);return a.state={pieces:e.pieces.map((function(e,t){return{key:e.key,paths:e.paths,originalPosition:e.transform,position:e.transform,color:n(t),guideRef:i.a.createRef(),pieceRef:i.a.createRef()}})),tolerance:30},a.ref=i.a.createRef(),a.handleDragStart=a.handleDragStart.bind(Object(p.a)(a)),a.handleDragStop=a.handleDragStop.bind(Object(p.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.getDragScale(this.props.width,this.props.height),a=this.state.pieces.map((function(a,n){return i.a.createElement(M,{index:n,paths:a.paths,key:a.key,color:a.color,onDragStart:e.handleDragStart,onDragStop:e.handleDragStop,dragScale:t,ref:a.pieceRef,locked:"end"===e.props.stage,position:a.position,svgRef:e.ref})})),n=this.state.pieces.map((function(e,t){return i.a.createElement(N,{paths:e.paths,ref:e.guideRef,key:t})})),s=this.props.devMode?i.a.createElement("rect",{x:this.props.viewBox[0],y:this.props.viewBox[1],width:this.props.viewBox[2],height:this.props.viewBox[3]}):null;return i.a.createElement("div",{className:"puzzle"},i.a.createElement("svg",{width:this.props.width,height:this.props.height,viewBox:this.props.viewBox.join(" "),ref:this.ref},s,n,a))}},{key:"componentDidUpdate",value:function(e){if(e.stage!==this.props.stage)switch(this.props.stage){case"editing":case"initial":this.setState({pieces:this.state.pieces.map((function(e){return e.position=e.originalPosition,e}))});break;case"end":this.setState({pieces:this.state.pieces.map((function(e){return e.position=[0,0],e}))})}}},{key:"getDragScale",value:function(e,t){if("object"===typeof this.ref){var a=this.props.viewBox;return e/t>a[2]/a[3]?t/this.props.viewBox[3]:e/this.props.viewBox[2]}}},{key:"movePieceToFront",value:function(e){e!==this.state.pieces.length-1&&this.setState({pieces:[].concat(Object(O.a)(this.state.pieces.slice(0,e)),Object(O.a)(this.state.pieces.slice(e+1,this.state.pieces.length)),[this.state.pieces[e]])})}},{key:"isPieceSolved",value:function(e){var t=Object(d.a)(this.state.pieces[e].position,2),a=t[0],n=t[1],i=this.state.tolerance;return a>-i&&a<i&&n>-i&&n<i}},{key:"isAllSolved",value:function(){var e=this;return this.state.pieces.forEach((function(t,a){return e.isPieceSolved(a)})),this.state.pieces.every((function(t,a){return e.isPieceSolved(a)}))}},{key:"handleDragStart",value:function(e){this.movePieceToFront(e)}},{key:"handleDragStop",value:function(e,t){this.state.pieces[e].position=[t.x,t.y],this.setState({pieces:Object(O.a)(this.state.pieces)}),this.isAllSolved()&&this.props.onSolved(),this.logPositions()}},{key:"logPositions",value:function(){if(this.props.devMode){var e=this.state.pieces.reduce((function(e,t){var a=t.position;if(a){var n=Object(d.a)(a,2),i=n[0],s=n[1];e[t.key]=[i.toFixed(1),s.toFixed(1)]}return e}),{});console.log(JSON.stringify(e))}}}]),t}(i.a.PureComponent),C=function(e){return i.a.createElement("div",{className:"slide"},i.a.createElement("div",null,i.a.createElement("h2",null,e.title),i.a.createElement("div",{className:"puzzle-btn btn-start",onClick:e.onStart},"Start!")))},U=function(e){var t=e.time;return i.a.createElement("div",{className:"timer"},i.a.createElement(g.d,null)," ",i.a.createElement("span",{className:"time"},function(e){var t=w(e),a=Object(d.a)(t,2),n=a[0],i=a[1],s=n>=10?"".concat(n):"0".concat(n),r=i>=10?"".concat(i):"0".concat(i);return"".concat(s,":").concat(r)}(t)))},W=.5,F=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).interval=void 0;var n=a.props.data,i=n.pieces,s=n.viewBox,r=n.title,c=n.shareText;return a.state={pieces:i,viewBox:s,title:r,shareText:c,startTime:new Date,duration:0,stage:"start",dimensions:{width:window.innerWidth,height:E({width:window.innerWidth,height:window.innerHeight},W).height}},a.handleSolved=a.handleSolved.bind(Object(p.a)(a)),a.handleStart=a.handleStart.bind(Object(p.a)(a)),a.handleRestart=a.handleRestart.bind(Object(p.a)(a)),a.handleTouchStart=a.handleTouchStart.bind(Object(p.a)(a)),a.handleResize=a.handleResize.bind(Object(p.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){switch(this.state.stage){case"start":return i.a.createElement("div",{className:"App"},i.a.createElement(C,{title:this.state.title,onStart:this.handleStart}),i.a.createElement(P,{stage:"initial",pieces:this.state.pieces,viewBox:this.state.viewBox,width:this.state.dimensions.width,height:this.state.dimensions.height}));case"puzzle":return i.a.createElement("div",{className:"App no-touch-action"},i.a.createElement("div",{className:"top-bar"},i.a.createElement(U,{time:this.state.duration}),i.a.createElement("div",{className:"puzzle-btn",onClick:this.handleRestart},i.a.createElement(g.b,null),i.a.createElement("span",null,"Restart"))),i.a.createElement(P,{stage:"editing",onSolved:this.handleSolved,pieces:this.state.pieces,viewBox:this.state.viewBox,width:this.state.dimensions.width,height:this.state.dimensions.height,devMode:!!b.devMode}));case"end":var e=function(e){var t=w(e),a=Object(d.a)(t,2),n=a[0],i=a[1],s=[];return 1===n?s.push("1 minute"):n>1&&s.push("".concat(n||0," minutes")),1===i?s.push("1 second"):i>1&&s.push("".concat(i||0," seconds")),s.join(", ")}(this.state.duration),t=this.state.shareText.replace("{time}",e);return i.a.createElement("div",{className:"App"},i.a.createElement(z,{title:"Solved!",subtitle:"You solved the puzzle in ".concat(e,"!"),shareText:t,onRestart:this.handleRestart}),i.a.createElement(P,{stage:"end",pieces:this.state.pieces,viewBox:this.state.viewBox,width:this.state.dimensions.width,height:this.state.dimensions.height}))}}},{key:"componentDidMount",value:function(){var e=this;document.addEventListener("touchstart",this.handleTouchStart),this.interval=setInterval((function(){return e.incrementTime()}),1e3);var t=new m.a.Child;t.getParentPositionInfo(),t.onMessage("viewport-iframe-position",(function(a){var n=a.split(" "),i=Object(d.a)(n,2),s=i[0],r=i[1];e.setState({dimensions:{width:window.innerWidth,height:E({width:s,height:Number(r)},W).height}}),t.sendHeight()}))}},{key:"handleResize",value:function(){var e=this;window.addEventListener("resize",(function(){var t=window.innerWidth;e.setState({dimensions:{width:t,height:E({width:t,height:window.innerHeight},W).height}})}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),document.removeEventListener("touchstart",this.handleTouchStart),clearInterval(this.interval)}},{key:"incrementTime",value:function(){var e;"puzzle"===this.state.stage&&this.setState({duration:Math.round((e=this.state.startTime,Math.round((new Date).getTime()-e.getTime())))})}},{key:"handleStart",value:function(){this.setState({startTime:new Date,stage:"puzzle"})}},{key:"handleSolved",value:function(){this.setState({stage:"end"})}},{key:"handleRestart",value:function(){this.setState({startTime:new Date,stage:"start",duration:0})}},{key:"handleTouchStart",value:function(e){"puzzle"===this.state.stage&&(e.preventDefault(),e.stopPropagation())}}]),t}(i.a.Component),L=a(72),A=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(L.a,{url:"puzzles/".concat(b.puzzle,".json"),responseType:"json"},(function(e){var t,a=e.fetching,n=e.failed,s=e.data;return a?i.a.createElement("div",null,"Loading puzzle..."):n?i.a.createElement("div",null,"Failed to load puzzle. Please try again later."):s?i.a.createElement(F,{data:(t=s,{viewBox:[t.viewBox.minX,t.viewBox.minY,t.viewBox.width,t.viewBox.height],pieces:Object.entries(t.paths).map((function(e){var a=Object(d.a)(e,2),n=a[0],i=a[1],s=t.transforms[n]||["0","0"],r=Object(d.a)(s,2),o=r[0],c=r[1];return{key:n,paths:i,transform:[parseFloat(o),parseFloat(c)]}})),title:t.title,shareText:t.shareText})}):null}))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},73:function(e,t,a){e.exports=a(141)},78:function(e,t,a){},79:function(e,t,a){}},[[73,1,2]]]);
//# sourceMappingURL=main.57179ffb.chunk.js.map